 function [ returnModels, extMetab] = prepareFBAmodel(speciesToConsider, directory, FBAsolver)
%prepareFBAmodel Loading species given as index list in speciesToConsider
%This sections retrieves file names from the directory

filenames= {'Abiotrophia_defectiva_ATCC_49176.mat','Achromobacter_xylosoxidans_A8.mat','Achromobacter_xylosoxidans_NBRC_15126.mat','Acidaminococcus_fermentans_DSM_20731.mat','Acidaminococcus_intestini_RyC_MR95.mat','Acidaminococcus_sp_D21.mat','Acinetobacter_baumannii_AB0057.mat','Acinetobacter_calcoaceticus_PHEA_2.mat','Acinetobacter_haemolyticus_NIPH_261.mat','Acinetobacter_johnsonii_SH046.mat','Acinetobacter_junii_SH205.mat','Acinetobacter_lwoffii_WJ10621.mat','Acinetobacter_pittii_ANC_4052.mat','Acinetobacter_radioresistens_NIPH_2130.mat','Actinobacillus_pleuropneumoniae_L20.mat','Actinomyces_cardiffensis_F0333.mat','Actinomyces_georgiae_DSM_6843.mat','Actinomyces_graevenitzii_C83.mat','Actinomyces_naeslundii_str_Howell_279.mat','Actinomyces_odontolyticus_ATCC_17982.mat','Actinomyces_oris_K20.mat','Actinomyces_turicensis_ACS_279_V_Col4.mat','Actinomyces_urogenitalis_DSM_15434.mat','Actinomyces_viscosus_C505.mat','Adlercreutzia_equolifaciens_DSM_19450.mat','Aerococcus_viridans_ATCC_11563.mat','Aeromonas_caviae_Ae398.mat','Aeromonas_hydrophila_subsp_hydrophila_ATCC_7966.mat','Aeromonas_jandaei_Riv2.mat','Aeromonas_media_WS.mat','Aeromonas_veronii_B565.mat','Afipia_birgiae_34632.mat','Aggregatibacter_aphrophilus_NJ8700.mat','Agrobacterium_tumefaciens_F2.mat','Akkermansia_muciniphila_ATCC_BAA_835.mat','Alcaligenes_faecalis_subsp_faecalis_NBRC_13111.mat','Alcaligenes_faecalis_subsp_faecalis_NCIB_8687.mat','Alistipes_finegoldii_DSM_17242.mat','Alistipes_indistinctus_YIT_12060.mat','Alistipes_onderdonkii_DSM_19147.mat','Alistipes_putredinis_DSM_17216.mat','Alistipes_shahii_WAL_8301.mat','Alloprevotella_tannerae_ATCC_51259.mat','Anaerobaculum_hydrogeniformans_OS1_ATCC_BAA_1850.mat','Anaerobiospirillum_succiniciproducens_DSM_640001.mat','Anaerococcus_hydrogenalis_DSM_7454.mat','Anaerococcus_prevotii_DSM_20548.mat','Anaerococcus_vaginalis_ATCC_51170.mat','Anaerofustis_stercorihominis_DSM_17244.mat','Anaerostipes_caccae_DSM_14662.mat','Anaerostipes_hadrus_DSM_3319.mat','Anaerostipes_sp_3_2_56FAA.mat','Anaerotruncus_colihominis_DSM_17241.mat','Aneurinibacillus_aneurinilyticus_ATCC_12856.mat','Arcanobacterium_haemolyticum_DSM_20595.mat','Arcobacter_butzleri_RM4018.mat','Arthrobacter_castelli_DSM_16402.mat','Atopobium_minutum_10063974.mat','Atopobium_parvulum_DSM_20469.mat','Atopobium_rimae_ATCC_49626.mat','Bacillus_altitudinis_41KF2b.mat','Bacillus_amyloliquefaciens_DSM7.mat','Bacillus_amyloliquefaciens_subsp_amyloliquefaciens_DC_12.mat','Bacillus_atrophaeus_ATCC_49822_1.mat','Bacillus_cereus_AH187_F4810_72.mat','Bacillus_cereus_G9842.mat','Bacillus_clausii_KSM_K16.mat','Bacillus_endophyticus_2102.mat','Bacillus_firmus_DS1.mat','Bacillus_flexus_27Col1_1E.mat','Bacillus_fordii_DSM_16014.mat','Bacillus_halodurans_C_125.mat','Bacillus_infantis_NRRL_B_14911.mat','Bacillus_licheniformis_ATCC_14580.mat','Bacillus_megaterium_DSM319.mat','Bacillus_mojavensis_RO_H_1.mat','Bacillus_mycoides_DSM_2048.mat','Bacillus_nealsonii_AAU1.mat','Bacillus_pseudofirmus_OF4.mat','Bacillus_pumilus_ATCC_7061.mat','Bacillus_sonorensis_L12.mat','Bacillus_subtilis_str_168.mat','Bacillus_thermoamylovorans.mat','Bacillus_thuringiensis_serovar_thuringiensis_str_T01001.mat','Bacillus_timonensis_10403023.mat','Bacillus_vallismortis_DV1_F_3.mat','Bacteroides_caccae_ATCC_43185.mat','Bacteroides_cellulosilyticus_DSM_14838.mat','Bacteroides_clarus_YIT_12056.mat','Bacteroides_coprocola_M16_DSM_17136.mat','Bacteroides_coprophilus_DSM_18228.mat','Bacteroides_dorei_DSM_17855.mat','Bacteroides_eggerthii_1_2_48FAA.mat','Bacteroides_eggerthii_DSM_20697.mat','Bacteroides_faecis_MAJ27.mat','Bacteroides_finegoldii_DSM_17565.mat','Bacteroides_fluxus_YIT_12057.mat','Bacteroides_fragilis_3_1_12.mat','Bacteroides_fragilis_638R.mat','Bacteroides_fragilis_NCTC_9343.mat','Bacteroides_fragilis_YCH46.mat','Bacteroides_graminisolvens_DSM_19988.mat','Bacteroides_intestinalis_341_DSM_17393.mat','Bacteroides_massiliensis_B846dnLKV334.mat','Bacteroides_nordii_CL02T12C05.mat','Bacteroides_oleiciplenus_YIT_12058.mat','Bacteroides_ovatus_ATCC_8483.mat','Bacteroides_ovatus_SD_CC_2a.mat','Bacteroides_ovatus_SD_CMC_3f.mat','Bacteroides_pectinophilus_ATCC_43243.mat','Bacteroides_plebeius_M12_DSM_17135.mat','Bacteroides_pyogenes_DSM20611.mat','Bacteroides_salyersiae_WAL_10018.mat','Bacteroides_sp_1_1_14.mat','Bacteroides_sp_1_1_30.mat','Bacteroides_sp_1_1_6.mat','Bacteroides_sp_20_3.mat','Bacteroides_sp_2_1_22.mat','Bacteroides_sp_2_1_33B.mat','Bacteroides_sp_2_1_7.mat','Bacteroides_sp_2_2_4.mat','Bacteroides_sp_3_1_19.mat','Bacteroides_sp_3_1_23.mat','Bacteroides_sp_3_1_33FAA.mat','Bacteroides_sp_3_1_40A.mat','Bacteroides_sp_3_2_5.mat','Bacteroides_sp_4_1_36.mat','Bacteroides_sp_4_3_47FAA.mat','Bacteroides_sp_9_1_42FAA.mat','Bacteroides_sp_D1.mat','Bacteroides_sp_D2.mat','Bacteroides_sp_D20.mat','Bacteroides_sp_D22.mat','Bacteroides_stercoris_ATCC_43183.mat','Bacteroides_thetaiotaomicron_VPI_5482.mat','Bacteroides_timonensis_AP1.mat','Bacteroides_uniformis_ATCC_8492.mat','Bacteroides_ureolyticus_DSM_20703.mat','Bacteroides_vulgatus_ATCC_8482.mat','Bacteroides_xylanisolvens_SD_CC_1b.mat','Bacteroides_xylanisolvens_XB1A.mat','Barnesiella_intestinihominis_YIT_11860.mat','Bartonella_quintana_Toulouse.mat','Bifidobacterium_adolescentis_ATCC_15703.mat','Bifidobacterium_angulatum_DSM_20098.mat','Bifidobacterium_animalis_lactis_AD011.mat','Bifidobacterium_animalis_lactis_BB_12.mat','Bifidobacterium_animalis_lactis_Bi_07.mat','Bifidobacterium_animalis_lactis_Bl_04_ATCC_SD5219.mat','Bifidobacterium_animalis_lactis_CNCM_I_2494.mat','Bifidobacterium_animalis_lactis_DSM_10140.mat','Bifidobacterium_animalis_lactis_V9.mat','Bifidobacterium_bifidum_BGN4.mat','Bifidobacterium_bifidum_NCIMB_41171.mat','Bifidobacterium_bifidum_PRL2010.mat','Bifidobacterium_bifidum_S17.mat','Bifidobacterium_boum_DSM_20432.mat','Bifidobacterium_breve_HPH0326.mat','Bifidobacterium_breve_UCC2003_NCIMB8807.mat','Bifidobacterium_catenulatum_DSM_16992.mat','Bifidobacterium_coryneforme_DSM_20216.mat','Bifidobacterium_dentium_ATCC_27678.mat','Bifidobacterium_gallicum_DSM_20093.mat','Bifidobacterium_kashiwanohense_DSM_21854.mat','Bifidobacterium_longum_DJO10A.mat','Bifidobacterium_longum_E18.mat','Bifidobacterium_longum_NCC2705.mat','Bifidobacterium_longum_infantis_157F_NC.mat','Bifidobacterium_longum_infantis_ATCC_15697.mat','Bifidobacterium_longum_longum_ATCC_55813.mat','Bifidobacterium_longum_longum_BBMN68.mat','Bifidobacterium_longum_longum_CCUG_52486.mat','Bifidobacterium_longum_longum_JCM_1217.mat','Bifidobacterium_longum_longum_JDM301.mat','Bifidobacterium_mongoliense_DSM_21395.mat','Bifidobacterium_pseudocatenulatum_DSM_20438.mat','Bifidobacterium_pseudolongum_subsp_Pseudolongum_DSM_20099.mat','Bifidobacterium_ruminantium_DSM_6489.mat','Bifidobacterium_scardovii_JCM_12489.mat','Bifidobacterium_stercoris_DSM_24849.mat','Bifidobacterium_thermacidophilum_subsp_thermacidophilum_DSM_15837.mat','Bifidobacterium_thermophilum_RBL67.mat','Bilophila_wadsworthia_3_1_6.mat','Blastococcus_massiliensis_AP3.mat','Blautia_hansenii_VPI_C7_24_DSM_20583.mat','Blautia_hydrogenotrophica_DSM_10507.mat','Blautia_obeum_ATCC_29174.mat','Blautia_producta_DSM_2950.mat','Blautia_wexlerae_DSM_19850.mat','Bordetella_hinzii_OH87_BAL007II.mat','Brachybacterium_paraconglomeratum_LC44.mat','Brachyspira_pilosicoli_B2904.mat','Bradyrhizobium_elkanii_USDA_76.mat','Bradyrhizobium_japonicum_USDA_6.mat','Brevibacillus_agri_5_2.mat','Brevibacillus_agri_BAB_2500.mat','Brevibacillus_borstelensis_AK1.mat','Brevibacillus_brevis_NBRC_100599.mat','Brevibacterium_casei_S18.mat','Brevibacterium_linens_BL2.mat','Brevibacterium_massiliense_5401308.mat','Brevundimonas_bacteroides_DSM_4726.mat','Brevundimonas_diminuta_470_4.mat','Brochothrix_thermosphacta_DSM_20171.mat','Bulleidia_extructa_W1219.mat','Burkholderia_cepacia_GG4.mat','Burkholderiales_bacterium_1_1_47.mat','Butyricicoccus_pullicaecorum_1_2.mat','Butyricimonas_synergistica_DSM_23225.mat','Butyricimonas_virosa_DSM_23226.mat','Butyrivibrio_crossotus_DSM_2876.mat','Butyrivibrio_fibrisolvens_16_4.mat','Campylobacter_coli_JV20.mat','Campylobacter_concisus_13826.mat','Campylobacter_curvus_525_92.mat','Campylobacter_fetus_subsp_fetus_82_40.mat','Campylobacter_gracilis_RM3268.mat','Campylobacter_hominis_ATCC_BAA_381.mat','Campylobacter_hyointestinalis_subsp_hyointestinalis_LMG_9260.mat','Campylobacter_jejuni_jejuni_81_176.mat','Campylobacter_jejuni_jejuni_ICDCCJ07004.mat','Campylobacter_jejuni_jejuni_M1.mat','Campylobacter_jejuni_jejuni_NCTC_11168.mat','Campylobacter_lari_RM2100.mat','Campylobacter_rectus_RM3267.mat','Campylobacter_showae_CSUNSWCD.mat','Campylobacter_upsaliensis_JV21.mat','Candidatus_Nitrososphaera_gargensis_Ga9_2.mat','Capnocytophaga_granulosa_ATCC_51502.mat','Capnocytophaga_ochracea_DSM_7271.mat','Capnocytophaga_sputigena_ATCC_33612.mat','Catenibacterium_mitsuokai_DSM_15897.mat','Cedecea_davisae_DSM_4568.mat','Cellulosilyticum_lentocellum_DSM_5427.mat','Cellulosimicrobium_cellulans_J36.mat','Cetobacterium_somerae_ATCC_BAA_47401.mat','Citrobacter_amalonaticus_Y19.mat','Citrobacter_freundii_ATCC_8090.mat','Citrobacter_freundii_UCI_31.mat','Citrobacter_koseri_ATCC_BAA_895.mat','Citrobacter_sp_30_2.mat','Citrobacter_youngae_ATCC_29220.mat','Cloacibacillus_evryensis_DSM_19522.mat','Clostridiales_sp_1_7_47FAA.mat','Clostridium_acetobutylicum_ATCC_824.mat','Clostridium_asparagiforme_DSM_15981.mat','Clostridium_bartlettii_DSM_16795.mat','Clostridium_beijerinckii_NCIMB_8052.mat','Clostridium_bifermentans_ATCC_19299.mat','Clostridium_bolteae_ATCC_BAA_613.mat','Clostridium_botulinum_A_str_ATCC_19397.mat','Clostridium_botulinum_A_str_ATCC_3502.mat','Clostridium_botulinum_A_str_Hall.mat','Clostridium_botulinum_Bf.mat','Clostridium_botulinum_E1_str_BoNT_E_Beluga.mat','Clostridium_botulinum_F_str_230613.mat','Clostridium_butyricum_DSM_10702.mat','Clostridium_butyricum_E4_str_BoNT_E_BL5262.mat','Clostridium_cadaveris_AGR2141.mat','Clostridium_celatum_DSM_1785.mat','Clostridium_cellobioparum_DSM_1351.mat','Clostridium_citroniae_WAL_17108.mat','Clostridium_clariflavum_DSM_19732.mat','Clostridium_clostridioforme_CM201.mat','Clostridium_difficile_CD196.mat','Clostridium_difficile_NAP07.mat','Clostridium_difficile_NAP08.mat','Clostridium_difficile_R20291.mat','Clostridium_glycolicum_ATCC_14880.mat','Clostridium_hathewayi_12489931.mat','Clostridium_hathewayi_DSM_13479.mat','Clostridium_hiranonis_TO_931_DSM_13275.mat','Clostridium_hylemonae_DSM_15053.mat','Clostridium_indolis_DSM_755.mat','Clostridium_innocuum_2959.mat','Clostridium_leptum_DSM_753.mat','Clostridium_methoxybenzovorans_SR3.mat','Clostridium_methylpentosum_R2_DSM_5476.mat','Clostridium_nexile_DSM_1787.mat','Clostridium_paraputrificum_AGR2156.mat','Clostridium_perfringens_ATCC_13124.mat','Clostridium_ramosum_VPI_0427_DSM_1402.mat','Clostridium_saccharogumia_DSM_17460.mat','Clostridium_saccharoperbutylacetonicum_N1_4_HMT.mat','Clostridium_sartagoforme_AAU1.mat','Clostridium_scindens_ATCC_35704.mat','Clostridium_sordellii_ATCC_9714.mat','Clostridium_sp_7_2_43FAA.mat','Clostridium_sp_L2_50.mat','Clostridium_sp_M62_1.mat','Clostridium_sp_SS2_1.mat','Clostridium_sp_SY8519.mat','Clostridium_spiroforme_DSM_1552.mat','Clostridium_sporogenes_ATCC_15579.mat','Clostridium_sporosphaeroides_DSM_1294.mat','Clostridium_sticklandii_DSM_519.mat','Clostridium_symbiosum_ATCC_14940.mat','Clostridium_symbiosum_WAL_14163.mat','Clostridium_symbiosum_WAL_14673.mat','Clostridium_tyrobutyricum_DSM_2637.mat','Clostridium_viride_DSM_6836.mat','Collinsella_aerofaciens_ATCC_25986.mat','Collinsella_intestinalis_DSM_13280.mat','Collinsella_stercoris_DSM_13279.mat','Collinsella_tanakaei_YIT_12063.mat','Comamonas_testosteroni_CNB_2.mat','Coprobacillus_sp_29_1.mat','Coprobacillus_sp_D7.mat','Coprococcus_catus_GD_7.mat','Coprococcus_comes_ATCC_27758.mat','Coprococcus_eutactus_ATCC_27759.mat','Corynebacterium_ammoniagenes_DSM_20306.mat','Corynebacterium_amycolatum_SK46.mat','Corynebacterium_aurimucosum_ATCC_700975.mat','Corynebacterium_durum_F0235.mat','Corynebacterium_glucuronolyticum_ATCC_51867.mat','Corynebacterium_kroppenstedtii_DSM_44385.mat','Corynebacterium_propinquum_DSM_44285.mat','Corynebacterium_striatum_ATCC_6940.mat','Corynebacterium_tuberculostearicum_SK141.mat','Corynebacterium_ulcerans_809.mat','Corynebacterium_ureicelerivorans.mat','Cronobacter_sakazakii_ATCC_BAA_894.mat','Cryptobacterium_curtum_DSM_15641.mat','Curtobacterium_flaccumfaciens_UCD_AKU.mat','Delftia_acidovorans_SPH_1.mat','Dermacoccus_nishinomiyaensis.mat','Desulfovibrio_desulfuricans_subsp_desulfuricans_DSM_642.mat','Desulfovibrio_piger_ATCC_29098.mat','Desulfovibrio_sp_3_1_syn3.mat','Dialister_invisus_DSM_15470.mat','Dialister_succinatiphilus_YIT_11850.mat','Dietzia_cinnamea_P4.mat','Dorea_formicigenerans_ATCC_27755.mat','Dorea_longicatena_DSM_13814.mat','Dyadobacter_beijingensis_DSM_21582.mat','Dyadobacter_fermentans_DSM_18053.mat','Dysgonomonas_gadei_ATCC_BAA_286.mat','Edwardsiella_tarda_ATCC_23685.mat','Edwardsiella_tarda_FL6_60.mat','Eggerthella_lenta_DSM_2243.mat','Eggerthella_sp_1_3_56FAA.mat','Eggerthella_sp_YY7918.mat','Eggerthia_catenaformis_OT_569.mat','Eikenella_corrodens_ATCC_23834.mat','Enterobacter_aerogenes_KCTC_2190.mat','Enterobacter_asburiae_LF7a.mat','Enterobacter_cancerogenus_ATCC_35316.mat','Enterobacter_cloacae_EcWSU1.mat','Enterobacter_hormaechei_YT2.mat','Enterobacter_hormaechei_YT3.mat','Enterobacteriaceae_bacterium_9_2_54FAA.mat','Enterococcus_asini_ATCC_700915.mat','Enterococcus_avium_ATCC_14025.mat','Enterococcus_caccae_ATCC_BAA_1240.mat','Enterococcus_casseliflavus_ATCC_12755.mat','Enterococcus_cecorum_DSM_20682.mat','Enterococcus_dispar_ATCC_51266.mat','Enterococcus_durans_ATCC_6056.mat','Enterococcus_faecalis_OG1RF_ATCC_47077.mat','Enterococcus_faecalis_TX0104.mat','Enterococcus_faecalis_TX1322.mat','Enterococcus_faecalis_TX2134.mat','Enterococcus_faecalis_V583.mat','Enterococcus_faecium_TX1330.mat','Enterococcus_gallinarum_EG2.mat','Enterococcus_hirae_ATCC_9790.mat','Enterococcus_phoeniculicola_ATCC_BAA_412.mat','Enterococcus_saccharolyticus_DSM8903.mat','Enterococcus_sp_7L76.mat','Erysipelotrichaceae_bacterium_5_2_54FAA.mat','Erysipelotrichaceae_bacterium_sp_3_1_53.mat','Escherichia_albertii_KF1.mat','Escherichia_albertii_TW07627.mat','Escherichia_coli_O157_H7_str_Sakai.mat','Escherichia_coli_SE11.mat','Escherichia_coli_UTI89_UPEC.mat','Escherichia_coli_str_K_12_substr_MG1655.mat','Escherichia_fergusonii_ATCC_35469.mat','Escherichia_hermannii_NBRC_105704.mat','Escherichia_sp_1_1_43.mat','Escherichia_sp_3_2_53FAA.mat','Escherichia_sp_4_1_40B.mat','Eubacterium_biforme_DSM_3989.mat','Eubacterium_brachy_ATCC_33089.mat','Eubacterium_cellulosolvens_6.mat','Eubacterium_cylindroides_T2_87.mat','Eubacterium_desmolans_ATCC_43058.mat','Eubacterium_dolichum_DSM_3991.mat','Eubacterium_eligens_ATCC_27750.mat','Eubacterium_hallii_DSM_3353.mat','Eubacterium_hallii_L2_7.mat','Eubacterium_limosum_KIST612.mat','Eubacterium_ramulus_ATCC_29099.mat','Eubacterium_rectale_ATCC_33656.mat','Eubacterium_rectale_M104_1.mat','Eubacterium_saphenum_ATCC_49989.mat','Eubacterium_siraeum_70_3.mat','Eubacterium_siraeum_DSM_15702.mat','Eubacterium_sulci_ATCC_35585.mat','Eubacterium_ventriosum_ATCC_27560.mat','Exiguobacterium_aurantiacum_DSM_6208.mat','Faecalibacterium_cf_prausnitzii_KLE1255.mat','Faecalibacterium_prausnitzii_A2_165.mat','Faecalibacterium_prausnitzii_L2_6.mat','Faecalibacterium_prausnitzii_M21_2.mat','Faecalibacterium_prausnitzii_SL3_3.mat','Filifactor_alocis_ATCC_35896.mat','Finegoldia_magna_ATCC_29328.mat','Flavonifractor_plautii_ATCC_29863.mat','Fusobacterium_gonidiaformans_3_1_5R.mat','Fusobacterium_gonidiaformans_ATCC_25563.mat','Fusobacterium_mortiferum_ATCC_9817.mat','Fusobacterium_necrophorum_D12.mat','Fusobacterium_nucleatum_subsp_animalis_3_1_33.mat','Fusobacterium_nucleatum_subsp_animalis_7_1.mat','Fusobacterium_nucleatum_subsp_animalis_D11.mat','Fusobacterium_nucleatum_subsp_nucleatum_ATCC_25586.mat','Fusobacterium_nucleatum_subsp_vincentii_3_1_27.mat','Fusobacterium_nucleatum_subsp_vincentii_3_1_36A2.mat','Fusobacterium_nucleatum_subsp_vincentii_4_1_13.mat','Fusobacterium_periodonticum_1_1_41FAA.mat','Fusobacterium_periodonticum_2_1_31.mat','Fusobacterium_russii_ATCC_25533.mat','Fusobacterium_sp_4_8.mat','Fusobacterium_ulcerans_ATCC_49185.mat','Fusobacterium_varium_ATCC_27725.mat','Gemella_haemolysans_ATCC_10379.mat','Gemella_morbillorum_M424.mat','Gemella_sanguinis_ATCC700632.mat','Gemella_sanguinis_M325.mat','Geobacillus_stearothermophilus_ATCC_7953.mat','Geobacillus_vulcani_PSS1.mat','Gordonia_rubripertincta_NBRC_101908.mat','Gordonia_terrae_C_6.mat','Gordonia_terrae_NBRC_100016.mat','Gordonibacter_pamelaeae_7_10_1_bT_DSM_19378.mat','Granulicatella_adiacens_ATCC_49175.mat','Granulicatella_elegans_ATCC_700633.mat','Grimontia_hollisae_CIP_101886.mat','Haemophilus_haemolyticus_M19501.mat','Haemophilus_influenzae_R2846.mat','Haemophilus_parainfluenzae_T3T1.mat','Haemophilus_sputorum_CCUG_13788.mat','Hafnia_alvei_ATCC_51873.mat','Hafnia_alvei_BIDMC_31.mat','Halococcus_morrhuae_DSM1307.mat','Helicobacter_bilis_ATCC_43879.mat','Helicobacter_canadensis_MIT_98_5491.mat','Helicobacter_cinaedi_CCUG_18818.mat','Helicobacter_pullorum_MIT_98_5489.mat','Helicobacter_pylori_26695.mat','Helicobacter_winghamensis_ATCC_BAA_430.mat','Holdemania_filiformis_VPI_J1_31B_1_DSM_12042.mat','Kallipyga_massiliensis_ph2.mat','Kandleria_vitulina_DSM_20405.mat','Kingella_oralis_ATCC_51147.mat','Klebsiella_oxytoca_KCTC_1686.mat','Klebsiella_pneumoniae_pneumoniae_MGH78578.mat','Klebsiella_sp_1_1_55.mat','Kluyvera_ascorbata_ATCC_33433.mat','Kocuria_palustris_PEL.mat','Kocuria_rhizophila_DC2201.mat','Kurthia_massiliensis_JC30.mat','Kytococcus_sedentarius_DSM_20547.mat','Lachnospira_multipara_ATCC_19207.mat','Lachnospiraceae_bacterium_sp_5_1_63FAA.mat','Lachnospiraceae_bacterium_sp_8_1_57FAA.mat','Lactobacillus_acidophilus_ATCC_4796.mat','Lactobacillus_acidophilus_NCFM.mat','Lactobacillus_amylolyticus_DSM_11664.mat','Lactobacillus_amylovorus_GRL_1112.mat','Lactobacillus_animalis_KCTC_3501.mat','Lactobacillus_antri_DSM_16041.mat','Lactobacillus_brevis_ATCC_367.mat','Lactobacillus_brevis_subsp_gravesensis_ATCC_27305.mat','Lactobacillus_buchneri_ATCC_11577.mat','Lactobacillus_casei_ATCC_334.mat','Lactobacillus_casei_casei_BL23.mat','Lactobacillus_coleohominis_101_4_CHN.mat','Lactobacillus_coryniformis_subsp_coryniformis_CECT_5711.mat','Lactobacillus_crispatus_125_2_CHN.mat','Lactobacillus_curvatus_CRL_705.mat','Lactobacillus_delbrueckii_subsp_bulgaricus_ATCC_11842.mat','Lactobacillus_delbrueckii_subsp_bulgaricus_ATCC_BAA_365.mat','Lactobacillus_fermentum_ATCC_14931.mat','Lactobacillus_fermentum_IFO_3956.mat','Lactobacillus_gasseri_ATCC_33323.mat','Lactobacillus_gastricus_PS3.mat','Lactobacillus_helveticus_DPC_4571.mat','Lactobacillus_helveticus_DSM_20075.mat','Lactobacillus_hilgardii_ATCC_8290.mat','Lactobacillus_iners_DSM_13335.mat','Lactobacillus_jensenii_1153.mat','Lactobacillus_johnsonii_DPC_6026.mat','Lactobacillus_johnsonii_NCC_533.mat','Lactobacillus_mucosae_LM1.mat','Lactobacillus_oris_F0423.mat','Lactobacillus_paracasei_subsp_paracasei_8700_2.mat','Lactobacillus_paracasei_subsp_paracasei_ATCC_25302.mat','Lactobacillus_pentosus_KCA1.mat','Lactobacillus_plantarum_JDM1.mat','Lactobacillus_plantarum_WCFS1.mat','Lactobacillus_plantarum_subsp_plantarum_ATCC_14917.mat','Lactobacillus_reuteri_CF48_3A_.mat','Lactobacillus_reuteri_F275_JCM_1112.mat','Lactobacillus_reuteri_MM2_3_.mat','Lactobacillus_reuteri_MM4_1A_.mat','Lactobacillus_reuteri_SD2112_ATCC_55730.mat','Lactobacillus_rhamnosus_GG_ATCC_53103.mat','Lactobacillus_rhamnosus_LMS2_1.mat','Lactobacillus_ruminis_ATCC_25644.mat','Lactobacillus_sakei_subsp_sakei_23K.mat','Lactobacillus_salivarius_HO66_ATCC_11741.mat','Lactobacillus_salivarius_salivarius_UCC118.mat','Lactobacillus_ultunensis_DSM_16047.mat','Lactobacillus_vaginalis_ATCC_49540.mat','Lactococcus_garvieae_ATCC_49156.mat','Lactococcus_lactis_subsp_lactis_Il1403.mat','Lactococcus_raffinolactis_4877.mat','Laribacter_hongkongensis_HLHK9.mat','Lautropia_mirabilis_ATCC_51599.mat','Leminorella_grimontii_ATCC_33999.mat','Leptotrichia_buccalis_C_1013_b.mat','Leuconostoc_argentinum_KCTC_3773.mat','Leuconostoc_gelidum_JB7.mat','Leuconostoc_lactis_KACC_91922.mat','Leuconostoc_mesenteroides_subsp_cremoris_ATCC_19254.mat','Listeria_grayi_DSM_20601.mat','Listeria_monocytogenes_4a_L99.mat','Listeria_monocytogenes_4b_F2365.mat','Listeria_monocytogenes_FSL_R2_561.mat','Listeria_monocytogenes_Finland_1988.mat','Listeria_monocytogenes_J0161_FSL_R2_499.mat','Listeria_monocytogenes_SLCC_2378.mat','Listeria_monocytogenes_SLCC_2540.mat','Listeria_monocytogenes_SLCC_7179.mat','Listeria_monocytogenes_serotype_7_SLCC_2482.mat','Lysinibacillus_fusiformis_ZB2.mat','Lysinibacillus_sphaericus_C3_41.mat','Marvinbryantia_formatexigens_I_52_DSM_14469.mat','Megamonas_funiformis_YIT_11815.mat','Megamonas_hypermegale_ART12_1.mat','Megasphaera_elsdenii_DSM_20460.mat','Melainabacterium_MEL_A1.mat','Mesorhizobium_loti_MAFF303099.mat','Methanobrevibacter_ruminantium_M1.mat','Methanobrevibacter_smithii_ATCC_35061.mat','Methanomassiliicoccus_luminyensis_B10.mat','Methanosphaera_stadtmanae_DSM_3091.mat','Methylobacterium_mesophilicum_SR1_6_6.mat','Methylobacterium_populi_BJ001.mat','Methylobacterium_radiotolerans_JCM_2831.mat','Methyloversatilis_universalis_FAM5.mat','Methyloversatilis_universalis_Fam50001.mat','Microbacterium_gubbeenense_DSM_15944.mat','Microbacterium_oleivorans_NBRC_103075.mat','Microbacterium_paraoxydans_77MFTsu3_2.mat','Micrococcus_luteus_NCTC_2665.mat','Micromonospora_aurantiaca_ATCC_27029.mat','Mitsuokella_jalaludinii_DSM_13811.mat','Mitsuokella_multacida_DSM_20544.mat','Mobiluncus_curtisii_ATCC_43063.mat','Mogibacterium_timidum_ATCC_33093.mat','Moraxella_catarrhalis_RH4.mat','Morganella_morganii_subsp_morganii_KT.mat','Mycobacterium_avium_subsp_avium_ATCC_25291.mat','Mycobacterium_fortuitum_subsp_fortuitum_DSM_46621.mat','Mycoplasma_hominis_ATCC_23114.mat','Mycoplasma_pneumoniae_309.mat','Neisseria_cinerea_ATCC_14685.mat','Neisseria_elongata_subsp_glycolytica_ATCC_29315.mat','Neisseria_flavescens_SK114.mat','Neisseria_macacae_ATCC_33926.mat','Neisseria_mucosa_ATCC_25996.mat','Neisseria_subflava_NJ9703.mat','Nevskia_ramosa_DSM_11499.mat','Oceanobacillus_picturae_strain_S1.mat','Ochrobactrum_anthropi_ATCC_49188.mat','Ochrobactrum_intermedium_LMG_3301.mat','Odoribacter_laneus_YIT_12061.mat','Odoribacter_splanchnicus_1651_6_DSM_20712.mat','Olsenella_profusa_F019501.mat','Olsenella_uli_DSM_7084.mat','Oribacterium_sinus_F0268.mat','Oxalobacter_formigenes_HOxBLS.mat','Oxalobacter_formigenes_OXCC13.mat','Paenibacillus_alvei_DSM_29.mat','Paenibacillus_barengoltzii_G22.mat','Paenibacillus_daejeonensis_DSM_15491.mat','Paenibacillus_graminis_C4D1M.mat','Paenibacillus_lactis_154.mat','Pantoea_agglomerans_IG1.mat','Parabacteroides_distasonis_ATCC_8503.mat','Parabacteroides_goldsteinii_dnLKV18.mat','Parabacteroides_gordonii_DSM_23371.mat','Parabacteroides_johnsonii_DSM_18315.mat','Parabacteroides_merdae_ATCC_43184.mat','Parabacteroides_sp_D13.mat','Paracoccus_yeei_ATCC_BAA_599.mat','Paraprevotella_clara_YIT_11840.mat','Paraprevotella_xylaniphila_YIT_11841.mat','Parasutterella_excrementihominis_YIT_11859.mat','Parvimonas_micra_ATCC_33270.mat','Pediococcus_acidilactici_7_4.mat','Pediococcus_acidilactici_DSM_20284.mat','Pediococcus_pentosaceus_ATCC_25745.mat','Peptoniphilus_harei_ACS_146_V_Sch2b.mat','Peptoniphilus_indolicus_ATCC_29427.mat','Peptoniphilus_lacrimalis_DSM_7455.mat','Peptoniphilus_timonensis_JC401.mat','Peptostreptococcus_anaerobius_DSM_2949.mat','Peptostreptococcus_stomatis_DSM_17678.mat','Phascolarctobacterium_succinatutens_YIT_12067.mat','Plesiomonas_shigelloides_302_73.mat','Porphyromonas_asaccharolytica_DSM_20707.mat','Porphyromonas_endodontalis_ATCC_35406.mat','Porphyromonas_gingivalis_W83.mat','Porphyromonas_somerae_DSM_23386.mat','Porphyromonas_uenonis_60_3.mat','Porphyromonas_uenonis_DSM_23387.mat','Prevotella_albensis_DSM_11370.mat','Prevotella_bivia_DSM_20514.mat','Prevotella_brevis_ATCC_19188.mat','Prevotella_bryantii_B14.mat','Prevotella_bryantii_C21a.mat','Prevotella_buccae_ATCC_33574.mat','Prevotella_conceptionensis_9403948.mat','Prevotella_copri_CB7_DSM_18205.mat','Prevotella_corporis_DSM_18810.mat','Prevotella_denticola_DSM20614.mat','Prevotella_denticola_F0289.mat','Prevotella_disiens_FB035_09AN.mat','Prevotella_disiens_JCM_6334.mat','Prevotella_enoeca_JCM_12259.mat','Prevotella_intermedia_17.mat','Prevotella_intermedia_ATCC_25611.mat','Prevotella_loescheii_DSM_19665.mat','Prevotella_melaninogenica_ATCC_25845.mat','Prevotella_nanceiensis_DSM_19126.mat','Prevotella_nigrescens_ATCC_33563.mat','Prevotella_oralis_ATCC_33269.mat','Prevotella_pallens_ATCC_700821.mat','Prevotella_ruminicola_23.mat','Prevotella_salivae_DSM_15606.mat','Prevotella_shahii_JCM_12083.mat','Prevotella_stercorea_DSM_18206.mat','Prevotella_timonensis_4401737.mat','Prevotella_timonensis_CRIS_5C_B1.mat','Prevotella_veroralis_DSM_19559.mat','Propionibacterium_acidipropionici_ATCC_4875.mat','Propionibacterium_acnes_KPA171202.mat','Propionibacterium_avidum_44067.mat','Propionibacterium_freudenreichii_subsp_shermanii_CIRM_BIA1.mat','Propionibacterium_granulosum_DSM_20700.mat','Propionibacterium_jensenii_DSM_20535.mat','Propionibacterium_propionicum_F0230a.mat','Proteus_mirabilis_ATCC_29906.mat','Proteus_penneri_ATCC_35198.mat','Providencia_alcalifaciens_DSM_30120.mat','Providencia_rettgeri_DSM_1131.mat','Providencia_rustigianii_DSM_4541.mat','Providencia_stuartii_ATCC_25827.mat','Pseudobutyrivibrio_ruminis_AD2017.mat','Pseudoflavonifractor_capillosus_strain_ATCC_29799.mat','Pseudomonas_aeruginosa_NCGM2_S1.mat','Pseudomonas_alcaliphila_34.mat','Pseudomonas_fluorescens_PfO_1.mat','Pseudomonas_monteilii_NBRC_103158.mat','Pseudomonas_monteilii_QM.mat','Pseudomonas_nitroreducens_HBP1.mat','Pseudomonas_oleovorans_MOIL14HWK12.mat','Pseudomonas_putida_F1.mat','Pseudomonas_stutzeri_DSM_4166.mat','Pseudoramibacter_alactolyticus_ATCC_23263.mat','Pyramidobacter_piscolens_W5455.mat','Ralstonia_sp_5_7_47FAA.mat','Raoultella_planticola_ATCC_33531.mat','Rhodococcus_equi_ATCC_33707.mat','Rhodococcus_equi_NBRC_101255.mat','Rhodococcus_erythropolis_PR4.mat','Rhodococcus_rhodochrous_ATCC_21198.mat','Roseburia_hominis_A2_183.mat','Roseburia_intestinalis_L1_82.mat','Roseburia_inulinivorans_DSM_16841.mat','Roseomonas_mucosa_ATCC_BAA_692.mat','Rothia_aeria_F0474.mat','Rothia_dentocariosa_ATCC_17931.mat','Rothia_mucilaginosa_DY_18.mat','Rudanella_lutea_DSM_19387.mat','Ruminococcaceae_bacterium_D16.mat','Ruminococcus_albus_7.mat','Ruminococcus_bicirculans_80_3.mat','Ruminococcus_bromii_L2_63.mat','Ruminococcus_callidus_ATCC_2776001.mat','Ruminococcus_champanellensis_18P13.mat','Ruminococcus_flavefaciens_ATCC_19208.mat','Ruminococcus_flavefaciens_FD_1.mat','Ruminococcus_gauvreauii_DSM_19829.mat','Ruminococcus_gnavus_ATCC_29149.mat','Ruminococcus_lactaris_ATCC_29176.mat','Ruminococcus_obeum_A2_162.mat','Ruminococcus_sp_5_1_39BFAA.mat','Ruminococcus_sp_SR1_5.mat','Ruminococcus_torques_ATCC_27756.mat','Ruminococcus_torques_L2_14.mat','Salmonella_enterica_enterica_sv_Typhimurium_LT2.mat','Scardovia_inopinata_F0304.mat','Schlesneria_paludicola_DSM_18645.mat','Selenomonas_ruminantium_AC2024.mat','Serratia_fonticola_RB_25.mat','Serratia_liquefaciens_ATCC_27592.mat','Serratia_marcescens_subsp_marcescens_Db11.mat','Shigella_dysenteriae_Sd197.mat','Shigella_flexneri_2002017.mat','Shigella_sonnei_Ss046.mat','Silanimonas_lenta_DSM_16282.mat','Slackia_exigua_ATCC_700122.mat','Slackia_piriformis_YIT_12062.mat','Solobacterium_moorei_DSM_22971.mat','Solobacterium_moorei_F0204.mat','Sphingomonas_paucimobilis_HER1398.mat','Spirosoma_linguale_DSM_74.mat','Staphylococcus_arlettae_CVD059.mat','Staphylococcus_aureus_subsp_aureus_USA300_FPR3757.mat','Staphylococcus_capitis_CR0101.mat','Staphylococcus_capitis_QN1.mat','Staphylococcus_caprae_C87.mat','Staphylococcus_cohnii_hu_01.mat','Staphylococcus_epidermidis_ATCC_12228.mat','Staphylococcus_equorum_subsp_equorum_Mu2.mat','Staphylococcus_haemolyticus_JCSC1435.mat','Staphylococcus_hominis_subsp_hominis_C80.mat','Staphylococcus_intermedius_ATCC_27335.mat','Staphylococcus_lugdunensis_HKU09_01.mat','Staphylococcus_pasteuri_SP1.mat','Staphylococcus_pettenkoferi_VCU012.mat','Staphylococcus_saprophyticus_subsp_saprophyticus_ATCC_15305.mat','Staphylococcus_sciuri_subsp_sciuri_Z8.mat','Staphylococcus_simulans_ACS_120_V_Sch1.mat','Staphylococcus_vitulinus_F1028.mat','Staphylococcus_warneri_SG1.mat','Staphylococcus_xylosus_DMB3_Bh1.mat','Staphylococcus_xylosus_NJ.mat','Stenotrophomonas_maltophilia_D457.mat','Stenotrophomonas_rhizophila_PCA13.mat','Stoquefichus_massiliensis_AP9.mat','Streptococcus_agalactiae_A909.mat','Streptococcus_anginosus_1_2_62CV.mat','Streptococcus_australis_ATCC_700641.mat','Streptococcus_constellatus_subsp_constellatus_SK53.mat','Streptococcus_constellatus_subsp_pharyngis_SK1060.mat','Streptococcus_cristatus_ATCC_51100.mat','Streptococcus_dysgalactiae_subsp_dysgalactiae_ATCC_27957.mat','Streptococcus_equi_subsp_equi_4047.mat','Streptococcus_equinus_ATCC_9812.mat','Streptococcus_gallolyticus_subsp_gallolyticus_ATCC_43143.mat','Streptococcus_gordonii_str_Challis_substr_CH1.mat','Streptococcus_infantarius_subsp_infantarius_ATCC_BAA_102.mat','Streptococcus_infantis_ATCC_700779.mat','Streptococcus_intermedius_JTH08.mat','Streptococcus_lutetiensis_033.mat','Streptococcus_mitis_NCTC_12261.mat','Streptococcus_mutans_ATCC_25175.mat','Streptococcus_oralis_Uo5.mat','Streptococcus_parasanguinis_ATCC_903.mat','Streptococcus_parauberis_KCTC_11537.mat','Streptococcus_peroris_ATCC_700780.mat','Streptococcus_pleomorphus_DSM_20574.mat','Streptococcus_pneumoniae_G54.mat','Streptococcus_pseudopneumoniae_IS7493.mat','Streptococcus_pyogenes_MGAS9429.mat','Streptococcus_salivarius_JIM8777.mat','Streptococcus_sanguinis_SK36.mat','Streptococcus_sp_2_1_36FAA.mat','Streptococcus_sp_I_G2.mat','Streptococcus_sp_I_P16.mat','Streptococcus_thermophilus_LMG_18311.mat','Streptococcus_thoraltensis_DSM_12221.mat','Streptococcus_uberis_0140J.mat','Streptococcus_vestibularis_F0396.mat','Subdoligranulum_variabile_DSM_15176.mat','Succinatimonas_hippei_YIT_12066.mat','Succinivibrio_dextrinosolvens_H5.mat','Sulfolobus_solfataricus_P2.mat','Sutterella_parvirubra_YIT_11816.mat','Sutterella_wadsworthensis_3_1_45B.mat','Tannerella_forsythia_ATCC_43037.mat','Tatumella_ptyseos_ATCC_33301.mat','Trabulsiella_guamensis_ATCC_49490.mat','Tropheryma_whipplei_str_Twist.mat','Trueperella_pyogenes_MS249.mat','Ureaplasma_parvum_serovar_1_str_ATCC_27813.mat','Ureaplasma_urealyticum_serovar_8_str_ATCC_27618.mat','Ureibacillus_thermosphaericus_str_Thermo_BF.mat','Varibaculum_cambriense_DSM_15806.mat','Veillonella_atypica_ACS_049_V_Sch6.mat','Veillonella_dispar_ATCC_17748.mat','Veillonella_parvula_Te3_DSM_2008.mat','Veillonella_ratti_ACS_216_V_Col6b.mat','Veillonella_sp_3_1_44.mat','Veillonella_sp_6_1_27.mat','Vibrio_fluvialis_560.mat','Vibrio_fluvialis_I21563.mat','Vibrio_fluvialis_PG41.mat','Vibrio_furnissii_NCTC_11218.mat','Vibrio_mimicus_MB_451.mat','Vibrio_parahaemolyticus_RIMD_2210633.mat','Weissella_cibaria_KACC_11862.mat','Weissella_confusa_LBAE_C39_2.mat','Weissella_paramesenteroides_ATCC_33313.mat','Yersinia_bercovieri_ATCC_43970.mat','Yersinia_enterocolitica_subsp_enterocolitica_8081.mat','Yersinia_frederiksenii_ATCC_33641.mat','Yersinia_kristensenii_ATCC_33638.mat','Yersinia_pseudotuberculosis_YPIII.mat','Yersinia_rohdei_ATCC_43380.mat','Yokenella_regensburgei_ATCC_43003.mat'};
%directory='D:\User\Juan Velasco\Documents\Doctorado\Modelo\AGORA-1.03-With-Mucins\reconstructions\mat\';
extMetab = {};
%FBAsolver=solverPars.FBAsolver;


for i = 1:length(speciesToConsider)
    disp(filenames(speciesToConsider(i)))
    models(i).COBRAmodel = readCbModel(strcat(directory, char(filenames(speciesToConsider(i)))));
    models(i).biomassReac = find(models(i).COBRAmodel.c);
    models(i).ngamReac = find(strncmp(models(i).COBRAmodel.rxns, 'NGAM', 4));
    if isempty(models(i).ngamReac)
        models(i).ngamReac = 0;
    end
            
    %% Case specific definition for the model. 
    dietConstraints=adaptVMHDietToAGORA('Unhealthy.txt','AGORA');
    models(i).COBRAmodel = useDiet(models(i).COBRAmodel, dietConstraints);
    models(i).COBRAmodel = changeRxnBounds(models(i).COBRAmodel, 'EX_o2(e)',0,'l'); %Anaerobios condition
    
    %The following section is applied when a defined medium is used. This
    %requires the media to be on an .xlsx file.
    
%     mediumDir= ''; %Directory for the xlsx file
%     cultMedia_comp1 = readtable(mediumDir, 'Sheet', 'Metabolite form', 'Range', 'B122:B189');%('D:\User\Juan Velasco\Documents\Doctorado\Modelo\MicrobiotaSintetica.xlsx','Sheet','Medium','Range','A68:A105');
%     cultMedia_comp1 = table2cell(cultMedia_comp1);
%     for j=1:length(cultMedia_comp1)
%         cultMedia_comp1(j) = strcat('EX_',cultMedia_comp1(j),'(e)');
%     end
%     cultMedia_conc = readtable('D:\User\Juan Velasco\Documents\Doctorado\Modelo\DM38MediumComp_Clark2020.xlsx', 'Sheet', 'Metabolite form', 'Range', 'C122:C189');%('D:\User\Juan Velasco\Documents\Doctorado\Modelo\MicrobiotaSintetica.xlsx','Sheet','Medium','Range','E68:E105');%'Medium','Range','A68:A105');
%     cultMedia_conc = table2cell(cultMedia_conc);
%     cultMedia_conc=cell2mat(cultMedia_conc);
%  
%     models(i).COBRAmodel = changeRxnBounds(models(i).COBRAmodel,cultMedia_comp1,-1*cultMedia_conc,'l');
%     EXRxns = find(strncmp(models(i).COBRAmodel.rxns, 'EX_', 3));
%     for j=1:length(EXRxns)
%         if models(i).COBRAmodel.lb(EXRxns(j)) == -1000
%            models(i).COBRAmodel = changeRxnBounds(models(i).COBRAmodel,models(i).COBRAmodel.rxns(EXRxns(j)),0,'l');
%            models(i).COBRAmodel = changeRxnBounds(models(i).COBRAmodel,models(i).COBRAmodel.rxns(EXRxns(j)),10,'u');
%         end
%      end
%                    
    %% Exchange reactions
    IDs = find(strncmp(models(i).COBRAmodel.rxns, 'EX_', 3));
    ReactionIDName = models(i).COBRAmodel.rxns(IDs, :);
    Sense = 0*ones(length(IDs), 1);
    models(i).exchangeReactions = table(IDs, cellstr(ReactionIDName), Sense, 'VariableNames',{'ReacID' 'ReacName' 'SecretionSense'}, 'RowNames', strtrim(cellstr(num2str(IDs))'));

    %% coupled reactions
    IDc = [];
    vmax = [];
    unlimited = max(models(i).COBRAmodel.ub);
    for k = 1:length(IDs)
        j = IDs(k);
        if ( 1 == 1 ) % only take restricted compounds into reactor and determine sense by set boundaries
            if models(i).COBRAmodel.lb(j) == -unlimited && models(i).COBRAmodel.ub(j) == unlimited
                continue
            end
            if models(i).COBRAmodel.lb(j) == -unlimited && models(i).COBRAmodel.ub(j) == 0
                continue
            end
            if models(i).COBRAmodel.lb(j) == 0 && models(i).COBRAmodel.ub(j) == unlimited
                continue
            end
            if models(i).COBRAmodel.lb(j) == models(i).COBRAmodel.ub(j)
                continue
            end
            if models(i).COBRAmodel.lb(j) == -unlimited || models(i).COBRAmodel.lb(j) == 0
                models(i).exchangeReactions.SecretionSense(num2str(j)) = 1;
                vmax(length(vmax)+1) = abs(models(i).COBRAmodel.ub(j));
            end
            if models(i).COBRAmodel.ub(j) == unlimited || models(i).COBRAmodel.ub(j) == 0
                models(i).exchangeReactions.SecretionSense(num2str(j)) = -1;
                vmax(length(vmax)+1) = abs(models(i).COBRAmodel.lb(j));
            end
            if models(i).exchangeReactions.SecretionSense(num2str(j)) ~= 0
                IDc(length(IDc)+1) = j;
                extMetab{length(extMetab)+1} = models(i).COBRAmodel.mets(find(models(i).COBRAmodel.S(:,j)));
            else
                error('Could not figure out SecretionSense!')
            end
        else % take all compounds into reactor, detect sense by position in reaction as educt or product
            models(i).exchangeReactions.SecretionSense(num2str(j)) = -1 * sign(models(i).COBRAmodel.S(find(models(i).COBRAmodel.S(:,j)),j));
            if models(i).exchangeReactions.SecretionSense(num2str(j)) == 1
                vmax(length(vmax)+1) = abs(models(i).COBRAmodel.lb(j));
            else
                vmax(length(vmax)+1) = abs(models(i).COBRAmodel.ub(j));
            end
            IDc(length(IDc)+1) = j;
            extMetab{length(extMetab)+1} = models(i).COBRAmodel.mets(find(models(i).COBRAmodel.S(:,j)));
        end 
    end
    
    ReacNames = models(i).COBRAmodel.rxns(IDc, :);
    inhibitedCoupledReactions = 0 * ones(length(IDc), 1);
    ks = 0 * ones(length(IDc), 1);
    models(i).coupledReactions = table(IDc', cellstr(ReacNames), models(i).exchangeReactions.SecretionSense(strtrim(cellstr(num2str(IDc'))')), vmax', ks, inhibitedCoupledReactions,'VariableNames', {'ReacID' 'ReacName' 'SecretionSense' 'vmax' 'ks' 'inhibited'}, 'RowNames', strtrim(cellstr(num2str(IDc'))));
    models(i).FBAsolver = FBAsolver;
    models(i).modelName = strtok(filenames(speciesToConsider(i)),'.'); % get filename w/o trailing '.xml'
    %
    Glc=find(strcmp(models(i).COBRAmodel.rxns, 'EX_glc_D(e)'));
        for h=1:length(models(i).coupledReactions.ReacID(1:end))
            if models(i).coupledReactions.ReacID(h) == Glc
                models(i).coupledReactions.vmax(h)= models(i).coupledReactions.vmax(h) *1000;
            end
        end
    %       
    returnModels(i) = convertToOnlyIrrevReac(models(i));
end

extMetab = [extMetab{:}]';
extMetab = unique(extMetab);

% prepare mapping to reactor compounds
for i = 1:length(speciesToConsider)
    ids = [];
    for j = 1:length(returnModels(i).coupledReactions.ReacID)
        % get compound of reaction
        compound = returnModels(i).COBRAmodel.mets(find(returnModels(i).COBRAmodel.S(:,returnModels(i).coupledReactions.ReacID(j))));
        % get index in reactor compounds
        ids(length(ids) + 1) = find(ismember(extMetab, compound));
     end
    
     returnModels(i).reactorCompoundIDs = ids;
 end

end